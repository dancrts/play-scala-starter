\c chaapy;

CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

--CREATE SCHEMA IF NOT EXISTS chaapy;

CREATE TABLE IF NOT EXISTS accounts (
    ACCOUNT_KEY         uuid            PRIMARY KEY NOT NULL DEFAULT uuid_generate_v4(),
    FULLNAME            VARCHAR(100),
    EMAIL               VARCHAR(255)    UNIQUE NOT NULL,
    PASSWORD            VARCHAR(100)    NOT NULL,
    CREATED_AT          TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PROFILE_PIC         uuid
);

CREATE TABLE IF NOT EXISTS conversations (
    CONVERSATION_KEY    uuid            PRIMARY KEY NOT NULL DEFAULT uuid_generate_v4(),
    PARTICIPANT_ONE     uuid            NOT NULL REFERENCES accounts (ACCOUNT_KEY) ON DELETE CASCADE ON UPDATE CASCADE,
    PARTICIPANT_TWO     uuid            NOT NULL REFERENCES accounts (ACCOUNT_KEY) ON DELETE CASCADE ON UPDATE CASCADE,
    CREATED_AT          TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS messages (
    MESSAGE_KEY         uuid            PRIMARY KEY NOT NULL DEFAULT uuid_generate_v4(),
    CONTENT             TEXT,
    SENDER_KEY          uuid            NOT NULL REFERENCES conversations (CONVERSATION_KEY) ON DELETE CASCADE ON UPDATE CASCADE,
    CONVERSATION_KEY    uuid            NOT NULL REFERENCES accounts (ACCOUNT_KEY) ON DELETE CASCADE ON UPDATE CASCADE,
    CREATED_AT          TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE IF NOT EXISTS workspaces (
    WORKSPACE_KEY       uuid            PRIMARY KEY NOT NULL DEFAULT uuid_generate_v4(),
    NAME                VARCHAR(50),
    DESCRIPTION         TEXT,
    IMAGE               uuid,
    COLOR               VARCHAR(50),
    MODIFIED_AT         TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CREATED_AT          TIMESTAMP       NOT NULL DEFAULT CURRENT_TIMESTAMP
);